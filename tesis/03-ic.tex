% !TeX TS-program = 
\documentclass[tesis.tex]{subfiles}

\begin{document}
\chapter{Grupos independientes de contexto.}
Este capítulo sigue las ideas de los trabajos \cite{muller1983groups} y \cite{muller1985theory} completando detalles que son omitidos por estos trabajos.

En la sección \ref{secc_grp_ic} probamos varias propiedades importantes de los lenguajes independientes de contexto que nos sirven para poder conectar la teoría de lenguajes con la teoría de grupos.

En la sección \ref{secc_wp} damos la definición formal del problema de la palabra de un grupo visto como un lenguaje y también damos una condición necesaria para que la clase de este lenguaje no dependa de los generadores elegidos para el grupo.


En la sección \ref{secc_teo_MS} probamos algunos resultados que nos garanticen tener una buena presentación para un grupo virtualmente libre y probamos el resultado central de este capítulo que es el teorema de Muller--Schupp \ref{teo_Muller_Schupp}.


\section{Propiedades de los lenguajes independiente de contexto.}\label{secc_grp_ic}

La familia de lenguajes independientes de contexto es la siguiente:
\[
	\text{IC} = \{  L \mid L  \ \text{es un lenguaje sobre un alfabeto} \ \Sigma \ \text{y} \ L \  \text{es independiente de contexto} \}.
\]
de manera similar podemos definir la familia de lenguajes regulares como
\[
	\text{REG} = \{  L \mid L  \ \text{es un lenguaje sobre un alfabeto} \ \Sigma \ \text{y} \ L \  \text{es regular} \}.
\]

La primera propiedad que vamos a ver de los lenguajes independiente de contexto es la intersección entre un lenguaje independiente de contexto y un lenguaje regular es un lenguaje independiente de contexto.

\begin{prop}\label{intersecciones-reg-ic}
	Sea $L \in \text{IC}$ y sea $R \in \text{REG}$ tales que existe $\Sigma$ de manera que $L,R \subseteq \Sigma^{*}$ entonces $L \cap R \in \text{IC}$.	
\end{prop}

\begin{proof}
	Sea $\Sigma$ un alfabeto finito y sean $L$ un lenguaje \ic tal que $L \subset \Sigma^*$ y $R$ un lenguaje regular tal que $R \subset \Sigma^*$. 
	Queremos ver que el lenguaje $L \cap R$ es aceptado por un \APND y así resulta ser un lenguaje independiente de contexto.
	
	Si $L$ es aceptado por un \APND ${\cal M } = (Q, \Sigma, Z, \delta, q_0, F, \$)$ y R es aceptado por un autómata no determinístico ${\cal M' } = (Q', \Sigma, \delta', q_0', F')$, consideremos el siguiente \APND
	\[
		{\cal N } = (Q \times Q', \Sigma, Z, \delta \times \delta', (q_0,q_0'), F \times F', \$),
	\]	
	tal que la función de transición está definida de la siguiente manera:
	para todo $q_{i} \in Q, q_{j}' \in Q', a \in \Sigma, Z \in \Gamma$ vale que
	si $(q,\gamma) \in \delta(q_{i},a,Z)$ para $\gamma \in \Gamma^*$ y $q'  \in \delta(q_{j}', a)$ entonces $ ((q,q'), \gamma) \in \delta \times \delta'((q_{i},q_{j}'),a,Z)$.
	
	
	Queremos ver que $L({\cal N}) = L \cap R $.	
	Probemos primero la siguiente afirmación.
	\[
	((q_0,q_0'), w, \$) \vdash^*_{\cal N}  ((q_i,q_j), \epsilon, z) \ \iff (q_0, w, \$) \vdash^*_{\cal M}  (q_i, \epsilon, z) \ \text{y} \ (q_0', w) \vdash^*_{\cal M'} (q_j, \epsilon)  	
	\]
	Para ver esto veremos las dos implicaciones a la vez haciendo inducción en la longitud de la palabra $w$.
	
	En el caso base $|w| = 1$ de manera que $w = a \in \Sigma$.
	Este caso tenemos la igualdad porque justamente la función de transición del \APND $\cal N$ es $\delta \times \delta'$.
	
	Para el paso inductivo consideremos que $|w|=n$ de manera que $w=ua$ con $|u|=n-1$ y $a \in \Sigma$.
	Luego tenemos que $((q_0,q_0'), u, \$) \vdash^*_{\cal N}  ((q_k,q_l), \epsilon, z') \ \iff (q_0, u, \$) \vdash^*_{\cal M}  (q_k, \epsilon, z') \ \text{y} \ (q_0', u) \vdash^*_{\cal M'} (q_l, \epsilon)$.
	Nuevamente usamos nuestra definición de la función de transición $\delta \times \delta'$ para concluir que
	\[ 
	((q_i,q_j),\epsilon, z) \in \delta \times \delta'((q_k,q_l), a, z') \iff  (q_i, a, z') \in \delta(q_k, a, z') \ \text{y} \ (q_j, a) \in \delta(q_l, a).
	\]	
	Con esto terminamos de probar la afirmación.
	
	Finalmente para ver que $L({\cal N})  =  L \cap R$ usamos que por nuestra afirmación si $w \in L \cap R$ entonces es aceptado por los dos autómatas $\cal M$ y por $\cal M'$, esto es que $(q_0, w, \$) \vdash^* (p, \epsilon, z)$ para $p \in F$ y que $(q_0', w) \vdash^* (p', \epsilon)$ para $p' \in F'$ y equivalentemente $((q_0,q_0'),w,\$) \vdash^* ((p, p'),\epsilon, z)$. 
	Dado que los estados finales del autómata $\cal N$ resultan ser $F \times F'$ obtenemos que $w \in L({\cal N}) \iff w \in L \cap R$.
	Concluimos así que el lenguaje $L \cap R$ resulta ser \ic tal como queríamos ver.		
\end{proof}

Ahora vamos a estudiar la relación de la familia de lenguajes \ic con los morfismos de monoides. 
Probaremos que IC es cerrada por imágenes de morfismos de monoides y por preimágenes de morfismos de monoides.
 

\begin{prop}\label{morfismos-monoides-ic}

		Sea $L \in \text{IC}$, $\Sigma$ tal que $L \subseteq \Sigma^{*}$ y $h:\Sigma^{*} \to \Delta^*$ un morfismo de monoides 
		 entonces $h(L) \in \text{IC}$.
		 
\end{prop}

\begin{proof}
		Consideramos $L$ lenguaje \ic sobre $\Sigma$.
		Esto nos dice que existe una gramática $\gramatica $ independiente de contexto, que tomamos en forma normal de Chomsky, tal que $L(\cG) = L$. 
		Si tenemos un morfismo de monoides $h: \Sigma^* \to \Delta^*$ consideramos la sustitución $\sigma:\Sigma \cup V \to \Delta^* \cup V$ definida por $\sigma(a) = h(a)$ para toda $a \in \Sigma$ y $\sigma(A) = A$ para toda $A \in V$.		
		Para probar que $h(L)$ es \ic vamos a construir una gramática $\cG'$ tal que $L(\cG') = h(L)$.
		Sea la gramática $\cG'  = (V, \Delta, P', S')$ tal que si $A \to w \in P$ luego $A \to \sigma(w) \in P'$.
		Es decir la única diferencia con la gramática $\cG$ es que reemplazamos en cada producción $P \in \cG$ a cada letra $a \in \Sigma$ por $h(a) \in \Delta^*$.
		La gramática sigue siendo \ic porque las producciones tienen la forma $A \to u$ con $A \in V, u \in (\Delta \cup V)^*$.
		Para finalizar la demostración nos alcanza con ver que genera al lenguaje que queremos.

		Notemos que por la definición de la gramática $\cG'$ tenemos que $L(\cG') \subseteq h(L)$. 
		Queremos ver la otra contención.		
		Para esto notemos que vale lo siguiente:
		\[
			S \to^* w \implies S' \to^{*} h(w).
		\]
		Si tenemos que $S \to^* w $  para $w = a_{1}a_{2} \dots a_{k}$ luego esto dice que existe una sucesión finita de producciones $P_{1} = S \to AB, \dots, P_{n} = C \to a_{j}$ para $ 1 \le j \le k$ de manera que 
		$S \to AB \to \dots \to a_{1}\dots C \dots a_{k} \to a_{1} \dots a_{j} \dots a_{k} = w$.
		Si tomamos la sucesión de producciones para la gramática $\cG'$ dada por $P'_{1} = S' \to A'B', \dots, P'_{n} = C' \to h(a_{j})$ luego obtuvimos que $S' \to^* h(w)$.
		Concluimos así que si $w \in L$ luego $h(w) \in L(\cG')$ lo que implica que $h(L) \subseteq L(\cG')$ y así que $L(\cG') = h(L)$ tal como queríamos ver.
\end{proof}


\begin{prop}
	\label{prop:IC_preimagenes_monoides}
	Sea $L \in \text{IC}$, $\Sigma$ tal que $L \subseteq \Sigma^{*}$ y $h:\Delta^{*} \to \Sigma^*$ un morfismo de monoides 
	entonces $h^{-1}(L) \in \text{IC}$.
\end{prop}

\begin{proof}
	Sea $L$ un lenguaje \ic sobre el alfabeto $\Sigma$ tal que es aceptado por un \APND ${\cal M } = (Q, \Sigma, Z, \delta, q_0, F, \$)$.
	Queremos ver que el lenguaje $h^{-1}(L) \subset \Delta^*$ es independiente de contexto.
	 
	 Consideremos el conjunto finito ${\cal U } = \{ h(a) \mid a \in \Delta \}$ luego $\text{Suf}(\cal U)$ los sufijos de estas finitas palabras.
%	Consideremos el número $ n = \max_{a \in \Delta} |h(a)|$ y el conjunto $\Sigma^{\le n} = \{ w \in \Sigma^* : |w| \le n  \}$.	
	Definimos un \APND de la siguiente forma
	\[
	{\cal M' } = (Q \times \text{Suf}({\cal U}), \Delta, Z, \delta, (q_0, \epsilon), F \times \{ \epsilon \}, \$)
	\]
	Finalmente nuestra función de transición resulta ser para $a \in \Delta, z \in Z, q \in Q$
	\begin{equation}\label{eq_prop_morf_1}
		\delta((q,\epsilon),a,z) = ((q,h(a)),z)
	\end{equation} 
	y en el caso que $u \in \text{Suf}(\cal U)$ y $u \neq \epsilon$ vale que si $u = yu'$ con $y \in \Sigma, u' \in \text{Suf}(\cal U)$ luego
	\begin{equation}\label{eq_prop_morf_2}
		\delta((q,yu'),\epsilon,z) = ((p,u'),z')
	\end{equation}
	si $\delta(q,y,z) = (p,z')$.
	
	Probemos primero la siguiente afirmación.
	Para cada $w \in \Delta^*$ tenemos la siguiente equivalencia,
	\[
	((q_0, \epsilon),w,z) \vdash^*_{\cal M'} ((q,\epsilon), \sigma) \iff (q_0,h(w), z) \vdash^*_{\cal M} (q, \sigma).
	\]
	
	Probamos esta equivalencia por inducción en la longitud de $|w|$.
	Para el caso base tenemos que $w = a \in \Delta$.
	En este caso tenemos que $((q_0, \epsilon), a, z) \vdash ((q,h(a)), z)$ usando una vez el caso \ref{eq_prop_morf_1} de la función de transición $\delta'$.
	Una vez en este estado por como definimos la función de transición tenemos que $ (q_0,h(a), z) \overset{*}{\vdash }(q, \sigma)  \iff ((q_0,h(a)), \epsilon ,z) \overset{*}{\vdash} ((q,\epsilon), \sigma)$ usando reiteradas veces el caso \ref{eq_prop_morf_2} de la función de transición $\delta'$.
	El caso general tenemos una palabra $w$ tal que $|w|=n$.
	Sabemos que la afirmación vale para cualquier palabra de longitud menor a $n$.
	En particular si $w=ua$ con $|u|=n-1$ y $a \in \Delta$, tenemos que por la hipótesis inductiva que 
	\[
	(q_0',u,z) \vdash^*_{\cal M'} ((q,\epsilon), \sigma) \iff (q_0,h(u), z) \vdash^*_{\cal M} (q, \sigma)
	\]
	entonces de nuevo por el mismo razonamiento que hicimos para el caso base tenemos probada la afirmación.
	
	Para concluir la demostración notamos que por nuestra afirmación si $w \in L(\cal M')$ entonces existe $q \in F$ tal que $ ((q_0, \epsilon),w,z) \vdash^*_{\cal M'} (q,\epsilon) $ y esto sucede sí y solo sí $(q_0,h(w), z) \vdash^*_{\cal M} (q, \sigma)$, dicho de otra forma que $h(w) \in L(\cal M)$.	
	Entonces $w \in L(\cal M')$ si y solo si $h(w) \in L$.
	Esto nos dice que el lenguaje aceptado por estado final de $\cal M'$ resulta ser $L' = \{ w \in \Delta^* : h(w) \in L \} = h^{-1}(L)$.
\end{proof}

La herramienta principal que tenemos para ver que cierto lenguaje $L$ no es \ic es usar el siguiente lema.

\begin{lema}[Pumping] \label{pumping}
	Sea $L$ un lenguaje independiente de contexto entonces existe una constante $n \ge 0$ tal que para todas las palabras $\gamma \in L$ de longitud al menos $n$ existe una factorización $\gamma = uvwxy$ con $|vwx| \le n$ y $|vx| > 0$ tal que para todo $i \in \NN$ vale que $uv^iwx^iy \in L$.
\end{lema}

\begin{proof}
	Ver \cite[p.281]{hopcraft-ullman}.
\end{proof}



\section{El problema de la palabra.}\label{secc_wp}


Sea $G$ un grupo finitamente generado por $A$ entonces si tomamos $B = A \cup A^{-1}$ el conjunto simétrico de generadores resulta que $G$ es finitamente generado como monoide por $B$, en otras palabras, existe un epimorfismo de monoides $\pi:B^* \to G$.
El problema de la palabra consiste en dadas $w,w' \in B^*$ determinar si $\pi(w) {=} \pi(w')$.
Equivalentemente esto es ver si $\pi(w'w^{-1}) = 1$.
Definimos entonces el siguiente lenguaje.

\begin{deff}
	Dado $G$ un grupo finitamente generado como monoide por $\Sigma$ 
	con epimorfismo de monoides $\pi:\Sigma^* \to G$ entonces
	el \emph{problema de la palabra de $G$ para los generadores $\Sigma$} es el siguiente lenguaje	
	\[ 
	\text{WP} (G, \Sigma) = \{ w \in \Sigma^* \ | \ \pi(w)= 1 \}.
	\]
\end{deff}

\begin{obs}
	En esta definición que damos del problema de la palabra no estamos considerando conjuntos simétricos de generadores sino que estamos considerando conjuntos de generadores como monoide.
	Esto es que $\Sigma$ no necesariamente cumple que $\Sigma = A \cup A^{-1}$ para $A$ conjunto finito de generadores de $G$ como grupo.
\end{obs}


El lenguaje del problema de la palabra depende de una elección de un conjunto finito de generadores, en principio no queda claro que si tomamos otro conjunto finito de generadores estos lenguajes tengan algo en común, como por ejemplo su clasificación.
Queremos saber bajo qué condiciones la familia a la cual pertence el lenguaje del problema de la palabra podría ser un invariante del grupo y así la clasificación del lenguaje del problema de la palabra no dependa del conjunto de generadores utilizado.
Para garantizar esto, nos enfocamos en las familias de lenguajes que cumplen las siguientes propiedades.
\medskip
\begin{deff}
	Una familia de lenguajes $\mathcal{C}$ es un \emph{cono} si para todo $L \in \mathcal{C}$ lenguaje sobre algún alfabeto finito $\Sigma$ resulta que:
	\begin{itemize}
		\item[\textbf{C1.}] Es cerrada por imágenes de morfismos de monoides de manera que para todo morfismo de monoides $\phi:\Sigma^* \to \Delta^*$ debe ser que $\phi(L) \in \mathcal{C}$.
		\item[\textbf{C2.}] Es cerrada por preimágenes de morfismos de monoides de manera que para todo morfismo de monoides  $\phi:\Delta^* \to \Sigma^*$ debe ser que $\phi^{-1}(L) \in \mathcal{C}$. 
		\item[\textbf{C3.}] Es cerrada por intersecciones con lenguajes regulares de manera que para todo lenguaje regular $R$ sobre el alfabeto $\Sigma$ vale que $L \cap R \in \mathcal{C}$.
	\end{itemize}
\end{deff} 

\begin{lema}
	La flia de lenguajes $\text{IC}$ es un cono.
\end{lema}
\begin{proof}
	Es consecuencia inmediata de las proposiciones							\ref{intersecciones-reg-ic}, \ref{morfismos-monoides-ic} y \ref{prop:IC_preimagenes_monoides}.
\end{proof}

Los conos de lenguajes cumplen la siguiente propiedad de gran importancia para el estudio del problema de la palabra.
\medskip
\begin{prop}\label{prop-cono-wp}
	Sea $\mathcal{C}$ cono de lenguajes, $G$ un grupo finitamente generado por $\Sigma$ como monoide y $WP(G, \Sigma)$ el lenguaje del problema de la palabra. 
	Si $WP(G, \Sigma) \in \mathcal{C}$ luego valen las siguientes afirmaciones:
	\begin{itemize}
		\item[\textbf{W1.}] Sea $\Delta$ conjunto finito de generadores de $G$ como monoide entonces $WP(G, \Delta) \in \mathcal{C}$. 
		\item[\textbf{W2.}] Sea $H$ subgrupo de $G$ finitamente generado por $\Omega$ entonces $WP(H, \Omega) \in \mathcal{C}$.
	\end{itemize} 
\end{prop}
\begin{proof}
	Vamos a probar \textbf{W1}.
	Como $\Delta$ y $\Sigma$ son dos conjuntos finitos de generadores de $G$ entonces tenemos dos epimorfismos de monoides:
	$\delta: \Delta^* \to G$ y $\pi:\Sigma^* \to G$.
	Si $\Delta = \{ b_{1}, \dots, b_{n} \}$ entonces definimos $\Delta' = \{ b'_{1}, \dots, b'_{n}   \} \subseteq \Sigma^*$ de manera que $b'_{i} \in \pi^{-1}(\delta(b_{i}))$ para todo $1 \le i \le n$.
	Definimos una función biyectiva $f:\Delta \to \Delta'$ como $f(b_{i}) = b'_{i}$ para todo $1 \le i \le n$.
	Por la propiedad universal de los monoides libres tenemos que existe $\ol f: \Delta^* \to \Sigma^*$ morfismo tal que hace conmutar al siguiente diagrama:
	\begin{center}
		\begin{tikzcd}
			\Delta^* \arrow[r, "\ol{f}",dashed ]  & \Sigma^* \\
			\Delta \arrow[ru, "f",  swap]  \arrow[u,"\iota",swap]  &  
		\end{tikzcd}
	\end{center}
	
	Por la construcción que hicimos del morfismo $\ol f$ tenemos que el siguiente diagrama también conmuta:
	\begin{center}
		\begin{tikzcd}
			\Delta^* \arrow[r, "\delta"] \arrow[d,"\ol{f}",swap] & G \\
			\Sigma^* \arrow[ru, "\pi",swap]    &  
		\end{tikzcd}
	\end{center}
	para probar que $\pi \circ \ol f = \delta$ nos alcanza con probarlo sobre $\Delta$.
	Para esto notemos que si $b_{i} \in \Delta$ luego $\pi(\ol f(b_{i})) = \pi(f(b_{i})) = \pi(b_{i}')$ donde $b_{i}' \in \pi^{-1}(\delta(b_{i}))$ lo que implica que $\pi(b'_{i}) = \delta(b_{i})$ tal como queríamos ver.
	
	
	Notemos que como el diagrama conmuta luego vale que 
	\[
	\ol{f}^{-1}(\pi^{-1}(1)) = \delta^{-1}(1)
	\]
	lo que implica que por la definición del lenguaje del problema de la palabra que
	\[
	\ol{f}^{-1}(WP(G,\Sigma)) = WP(G, \Delta).
	\]
	Como $WP(G, \Sigma) \in \mathcal{C}$ resulta que por la propiedad \textbf{C2} de los conos de lenguajes que $\ol{f}^{-1}(WP(G,\Sigma)) \in \mathcal{C}$ por lo tanto $WP(G, \Delta) \in \mathcal{C}$ tal como queríamos ver.
	
	Veamos ahora que vale \textbf{W2}. 
	Sea $\Omega$ conjunto de generadores de $H$.
	Podemos extender este conjunto a otro conjunto finito $\Sigma$ tal que $\Sigma$ genera a $G$ y $\Omega \subseteq \Sigma$. 
	De esta manera la siguiente igualdad es inmediata
	\[
	WP(H, \Omega) = WP(G, \Sigma) \cap \Omega^*
	\]
	y dado que $WP(G, \Sigma) \in \mathcal{C}$ entonces por la propiedad \textbf{C3} de los conos vale que $WP(H, \Omega) \in \mathcal{C}$.
	
\end{proof}

La moraleja de este resultado es que si $\mathcal{C}$ es un cono entonces si $G$ es un grupo finitamente generado tal que para cierto conjunto de generadores finito $\Sigma$ vale que $WP(G, \Sigma) \in \mathcal{C}$ luego decimos que $G$ es un grupo $\mathcal{C}$.



\begin{deff}
	Si $G$ es un \fg como monoide por un conjunto finito $\Sigma$ y el lenguaje $WP(G, \Sigma)$ es independiente de contexto entonces diremos que $G$ es un \emph{grupo independiente de contexto}.
\end{deff}

Construyamos algunos ejemplos de grupos independientes de contexto.
\begin{prop}
	Todo grupo libre $F$ finitamente generado es independiente de contexto.
\end{prop}
\begin{proof}
	Sea $F$ grupo libre generado por un conjunto finito $A$ tal que $1 \notin A$. 
	Sea  $B = A \cup A^{-1}$ el conjunto de generadores simétrico de $A$ y sea $\pi:B^* \to G$. 
	Dada $w \in B^*$ notaremos $\ol w$ a la palabra reducida que representa el mismo elemento que $w$ en el grupo $G$.
	
	Probemos que ${WP}(F,B)$ es un lenguaje independiente de contexto construyendo un autómata de pila $\cal M$ tal que acepte a este lenguaje.
	Consideremos el siguiente autómata de pila:
	\[
	{\cal M} = (\{ q_{0} \}, B, B \cup \{ 1 \}, \delta, q_{0}, \{q_{0}\}, 1). 
	\]
	
	Por como lo definimos tiene un solo estado que es final e inicial.
	El alfabeto de entrada es el conjunto de generadores $B$ mientras que el de pila es $B \cup \{ 1  \}$ donde $1$ es el símbolo inicial de la pila aunque no es la identidad del grupo libre o del monoide libre que denotaremos indistintamente $\epsilon$.
	Sean $b_{i}, b_{j} \in B$ luego notamos $b_{i} \cdot b_{j}$ su producto en el grupo libre $F$. 
	El autómata lo representamos de la siguiente manera: 
	
	\begin{center}
		\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=6.5cm,
			scale = 1,transform shape]
			
			\node[state,initial,accepting] (q_0) {$q_0$};
			
			\path 
			(q_0) edge    [loop above]          node {$b_{i}, b_{j} \mid  b_{i} \cdot b_{j}$ \ }  (q_0);
			
		\end{tikzpicture}
	\end{center}
	donde la definición de la función de transición está dada por 
	$\delta(q_{0}, b_{i}, b_{j}) =  (q_{0},b_{i} \cdot b_{j})$ donde $b_{i} \in B$ y $b_{j} \in B \cup \{ 1 \}$.


	Notemos que este autómata es determinístico.				
	Consideramos el lenguaje aceptado por estado final y por $1$ en la pila
	\[
	L({\cal M}, 1) = \{  w \in B^* \mid (q_{0},w,1)   \vdash^*  (q_{0}, \epsilon, 1)  \}.
	\]
	
	Probamos la siguiente observación:
	sea $w = uv \in B^*$ luego si
	$(q_{0},uv,1) \overset{*}{\vdash} (q,v,s)$ entonces $s = \ol u^R$, es decir la palabra reducida asociada a $u$ en reversa.
	
	Para probar esto lo hacemos por inducción en la longitud de $u$.
	Supongamos que $|w| \ge 1$ caso contrario no hay nada que probar.
	Sea entonces $w = bv$ con $b \in B$ y $v \in B^*$ tal que en este caso $u = b$.
	Tenemos que $(q_{0},bv,1) \vdash (q_{0},v,b)$ donde usamos que $\ol b^R = b$.
	Para el paso inductivo se sigue de manera idéntica.
	Supongamos que vale que: 		
	$(q_{0},uv,1) \overset{*}{\vdash} (q_{0}, v, \ol u^R)$.
	Sea $ |v| \ge 1 $, caso contrario no hay nada que probar, luego si $v=bv'$ para $b \in B$ y $v' \in B^{*}$ entonces 
	$(q,bv',{\ol u}^R ) {\vdash} (p,v',b \cdot {\ol u}^R)$.
	Donde $b \cdot {\ol u}^R$ es una palabra reducida y en este caso vale que $b \cdot {\ol u}^R = (\ol{u \cdot b})^R$ tal como queríamos ver.
	
	
	A partir de esta observación obtenemos que si $w \in L(\cal M)$ luego 
	$(q_{0},w,1) \overset{*}{\vdash} (q_{0},\epsilon,1)$ lo que nos dice que $\ol w = 1$ y esto implica que $w \in WP(F, B)$.
	Para la otra contención usamos que es un \APD por lo tanto cada palabra se puede consumir de una única forma y por la observación tenemos que $(q_{0},w,1) \overset{*}{\vdash} (q_{0},\epsilon,1)$ dado que $\ol w = 1$.
\end{proof}

En particular obtuvimos que los grupos libres tienen un problema de la palabra independiente de contexto determinístico especial.
Más en adelante construiremos un \APD que acepta al problema de la palabra de un grupo virtualmente libre generalizando esta misma construcción.
Veamos ahora un grupo que no es independiente de contexto.

\begin{prop}
	El grupo $\ZZ \times \ZZ$ no es independiente de contexto.
\end{prop}

\begin{proof}
	Tomamos los siguientes generadores como monoide $\Sigma = \{ a,b,c \}$ con morfismo de monoides $\pi: \Sigma^* \to \ZZ \times \ZZ$ dado por $\pi(a)=(1,0), \pi(b)=(0,1), \pi(c)=(-1,-1)$.
	Bajo esta presentación 
	\[
	WP(\ZZ \times \ZZ, \Sigma) = \{ \gamma \in \Sigma^*  : \ \exists n \in \NN, \ |\gamma|_a = |\gamma|_b = |\gamma|_c = n \}.
	\]
	Probemos que este lenguaje no es independiente de contexto.
	Para eso usamos el lema del pumping \ref{pumping} para probarlo por contradicción.
	Si fuera \ic debería existir una constante $n \ge 0$ tal que hace valer las hipótesis del lema.
	Consideremos la palabra $\gamma = a^n b^n c^n \in WP(G, \Sigma)$.
	Si tenemos una factorización 
	\[
	uvwxy = a^nb^nc^n
	\]
	tal que $|vwx| \le n$, esto implica que no todas las letras aparecen en $vwx$.
	Supongamos sin pérdida de generalidad que la letra que no aparece es $c$.
	Por otro lado como $|vx| > 0$ esto nos dice que al menos una letra aparece en la subpalabra $vx$.
	Si tomamos $i=0$ esto implicaría que $uwy \in WP(G,\Sigma)$ pero esto es una contradicción porque $|uwy|_{c} > |uwy|_{a}$ y $|uwy|_{c} > |uwy|_{b}$.
\end{proof}
 





\section{Teorema de Muller--Schupp.}\label{secc_teo_MS}

Nuestro objetivo es probar que todo grupo \vl resulta ser \ic pero para esto debemos  demostrar algunos resultados sobre grupos virtualmente libres.

Primero vamos a ver que todo grupo virtualmente libre puede tomarse de manera que el subgrupo libre sea normal.
Para eso nuestra estrategia es probar que la intersección de los conjugados del subgrupo libre tiene índice finito y también es un grupo libre.
Este resultado es una consecuencia del teorema de Nielsen--Schreier \ref{coro_niels_sch} probado en el capítulo anterior.


\begin{deff}
	Sea $G$ un grupo y $H$ un subgrupo entonces el \emph{normalizador} de $H$ en $G$ es el siguiente subgrupo
	\begin{equation*}
		N_G(H) = \{ g\in G : gHg^{-1} = H  \}.
	\end{equation*}
	Denotaremos por $S= \{ gHg^{-1} : g \in G  \}$ al \emph{conjunto de conjugados del subgrupo $H$}.

\end{deff}

 

El siguiente lema nos va decir que los grupos de índice finito tienen finitos conjugados.

\begin{lema}\label{lema_normalizador_conjugados}
	Si $G$ es un grupo finitamente generado y $H$ es un subgrupo de índice finito entonces $N_G(H)$ tiene índice finito y más aún $[G:N_G(H)] = |S|$.
\end{lema}
\begin{proof}
	Para ver que tiene índice finito notamos que $H \le N_G(H)$ por lo tanto tenemos que 
	\[
		[G:N_G(H)] \le [G:H] < \infty.
		\]
	Para probar la otra afirmación utilizamos el teorema de órbita-estabilizador para obtener que $|S| = |G/N_{G}(H)|$.

\end{proof}


\begin{lema}\label{lema_indice_interseccion}
	Sea $G$ grupo y $K_1, \dots, K_n$ subgrupos tales que $K_{i}$ tiene índice finito para todo $ 1 \le i \le n $ entonces $\bigcap_{i=1}^{n} K_{i}$ es un subgrupo de índice finito.
\end{lema}
\begin{proof}
	Lo probaremos por inducción en $n$ que es la cantidad de subgrupos de índice finito que estamos intersecando.
	En el caso base tenemos dos subgrupos $H,K$ de índice finito.
	Primero notamos que por el segundo teorema de isomorfismo para grupos tenemos que existe una biyección entre los siguientes conjuntos de cosets $ KH / H \simeq K / K \cap H $ (en principio ningún subgrupo es normal así que no podemos hablar de grupos sino de conjuntos).
	Como  $|KH / H| \le |G / H| < \infty$ dado que $H$ tiene índice finito obtenemos así que $|K / K \cap H| < \infty$.
	Entonces:
	\[
	[G:K\cap H] = [G:K][K: K \cap H]
	\]
	y como ambos índices de la derecha son finitos esto implica que $K \cap H$ es un subgrupo de índice finito tal como queríamos ver.
	
	Para la demostración del paso inductivo debemos ver que si tenemos $n$ subgrupos de índice finito $K_{1}, \dots, K_{n}$ entonces $\bigcap_{i=1}^{n} K_{i}$ también tiene índice finito.
	La demostración se reduce a la del caso base si tomamos $H = \bigcap_{i=1}^{n-1} K_{i}$ (que por hipótesis inductiva tiene índice finito) y $K = K_{n}$.
\end{proof}

Este lema nos garantiza que tomar subgrupos de índice finito preserva la propiedad de ser finitamente generado.

\begin{lema}\label{lema_subg_fg}
	Sea $G$ un \fg y sea $H$ subgrupo de índice finito entonces $H$ es un \fg.
\end{lema}
\begin{proof}
	Sea $A = \{g_1, \dots, g_n\}$ conjunto finito de generadores de $G$.
	Sea $T =\{t_1, \dots, t_m\}$ conjunto transversal a derecha de $H$ tal que $t_1=1$.
	
	Dado $g_j$ generador de $G$ deben existir $h_{ij} \in H$ y $k \in \{1, \dots, m\}$ tales que $h_{ij}t_{k} = t_ig_j$.
	También debe existir $h_i \in H$ de manera que $ h_i t_{k} = g_i$ para cierto $t_k$.
	Veamos que el conjunto finito 
	\[
	B = \{ \ h_{ ij}  \mid {1 \le j \le n, \  1 \le i \le m } \} \cup \{ \ h_i \mid {1 \le i \le n} \}
	\]
	genera a $H$.
	
	Dado $h \in H$ veamos que se puede escribir como una palabra en $B$. 
	Tenemos que 
	\[
	h = g_{i_1}\dots g_{i_r}
	\]
	donde usamos el conjunto finito de generadores de $G$.
	
	Por lo visto anteriormente podemos escribir  $g_{i_1} = h_{i_1}t_{k_1}$ para ciertos
	$h_{i_{1}} \in B, t_{k_{1}} \in T$.
	Entonces nos queda la siguiente escritura de $h$,
	\[
	h = h_{i_1}t_{k_1} g_{i_2}\dots g_{i_r}
	\]
	entonces usando que $h_{k_{1}i_{2}}t_{k_2} = t_{k_1}g_{i_2} $ llegamos a la siguiente escritura de $h$,
	\[
	h = h_{i_1}h_{k_{1}i_{2}}t_{k_2}\dots g_{i_r}.
	\]
	Repitiendo inductivamente este procedimiento llegamos a que $h =h_{i_1}h_{k_{1}i_{2}} \dots h_{k_{r}}t_{k_r}$.
	Necesariamente $t_{k_r} = 1$ porque $T$ es un conjunto de transversales a derecha de $H$ y $h \in H$.
	Concluimos que $B$ es un conjunto finito de generadores de $H$.
	
\end{proof}



\begin{lema}\label{lema_int_normal}
	Sea $G$ grupo, sea $H$ subgrupo de $G$ luego el subgrupo $K = \bigcap_{g \in G} gHg^{-1}$ es un subgrupo normal de $G$.
\end{lema}

\begin{proof}
	$K$ es un subgrupo porque la intersección de subgrupos es un subgrupo.
	Para ver que $K$ es normal notemos que dado $h \in G$ luego 
	\[
		 hKh^{-1} = \bigcap_{g \in G} hgHg^{-1}h^{-1} = \bigcap_{g' \in G} g'H(g')^{-1} =  K. 	
	\]
\end{proof}

Finalmente podemos probar que la clase de grupos que son virtualmente libres resulta ser cerrada por subgrupos de índice finito y que a su vez los subgrupos libres pueden ser tomados para que sean normales.

\begin{prop}\label{prop_vls}
	Para todo grupo $G$ \vl valen las siguientes propiedades.
	\begin{enumerate}
		\item Si $F$ es un subgrupo libre de índice finito de $G$ entonces existe $F'$ subgrupo de $G$ de manera que es normal, libre y tiene índice finito.
		\item Si $H$ es un subgrupo de $G$ de índice finito entonces $H$ es virtualmente libre.
	\end{enumerate}
\end{prop}

\begin{proof}
	Vamos a probar \textbf{1}.
	Si $G$ es virtualmente libre y $F$ es un subgrupo libre tenemos que la cantidad de conjugados de $F$ es finita por el lema \ref{lema_normalizador_conjugados} dado que el índice de $F$ en $G$ es finito.
	Por el lema \ref{lema_int_normal} tenemos que el siguiente subgrupo de $G$ es normal
	\[
	F' = \bigcap_{g \in G} gFg^{-1}.
	\]
	Veamos que este subgrupo $F'$ cumple las propiedades que queremos. 
	
	
	El subgrupo $F$ tiene índice finito y todos sus conjugados también tienen índice finito entonces $F'$ tiene índice finito por el lema \ref{lema_indice_interseccion}.
	Como $G$ es finitamente generado por ser virtualmente libre entonces usando \ref{lema_subg_fg} obtenemos que $F'$ es finitamente generado.
	Finalmente como $F'$ es subgrupo de $F$ y $F$ es un grupo libre entonces por el teorema de Nielsen--Schreier \ref{coro_niels_sch} obtenemos que $F'$ es libre también.
	
	
	Probemos \textbf{2}. 
	Por el lema \ref{lema_subg_fg} obtenemos directamente que $H$ es un grupo finitamente generado.
	Si $F$ es un libre de índice finito en $G$ podemos tomar $F \cap H$ que es libre por ser subgrupo de un libre nuevamente por el teorema de Nielsen--Schreier \ref{coro_niels_sch}.
	Por el lema \ref{lema_indice_interseccion} concluimos que $[G:F \cap H]$ es finito por lo tanto 
	\[
		[G:F \cap H] = [G : H][H : F \cap H] < \infty	
	\]
	y así concluimos que $F \cap H$ tiene índice finito en $H$ y por lo tanto $H$ es un grupo virtualmente libre.
	
\end{proof}

	\begin{prop}
		\label{prop:presentacion_vl}
		Sea  
		\begin{center}
			\begin{tikzcd}
				1 \arrow[r] & F \arrow[r, "\iota"] & G \arrow[r, "\pi"] & H \arrow[r] & 1
			\end{tikzcd}
		\end{center}
		sucesión exacta corta con $F$ un grupo libre de rango $n$ y $H$ grupo finito de orden $m$.
		Sea $T = \{ t_{1},\dots, t_{m} \}$ una transversal a derecha de $F$ en $G$ elegido de manera que $t_{1} = 1$.
		Sea $A$ un conjunto minimal de generadores para $F$ y sea $A \cup A^{-1} =  \{ a_{1}, \dots, a_{2n} \}$ el conjunto simétrico de generadores.
		Entonces
		\begin{enumerate}
			\item  Para todo $a_l \in A \cup A^{-1}, t_{i} \in T$ 
			existe $u_{il} \in F$ tal que $t_ia_{l}t_i^{-1} = u_{il}$.
			\item  Para todo $t_{i}, t_{j} \in T$ 
			existen $k_{ij} \in \{1, \dots, m \}$ y $z_{ij} \in F$ tales que 
			$t_it_j = z_{ij}t_{k_{ij}}$.
		\end{enumerate}
		Y más aún si
			\[
				W = A \cup T, \quad R = \{t_ia_{l}t_i^{-1} = u_{il}, \   t_it_j = z_{ij}t_{k_{ij}} \quad \forall (i,j,k,l) :   1 \le i,j,k \le m, 1 \le l  \le 2n \}.
			\]
		Entonces  $\langle W \mid R \rangle$ es una presentación como grupo de $G$.
	\end{prop}
	
	
	\begin{proof}
		Probamos \textbf{1}.
		Dado que $F$ es un subgrupo normal de $G$ tenemos que para todo $a_{l} \in A \cup A^{-1}$ y para todo $t_{i} \in T$ vale que $t_{i}a_{l}t_{i}^{-1} \in F$ por lo tanto existe $u_{il} \in F$ de manera que $u_{il} = t_{i}a_{l}t_{i}^{-1}$.

		Ahora probamos \textbf{2}.
		Sean $t_{i},t_{j} \in T$ luego tiene que existir $t_{k} \in T$ de manera $(t_{i}F)(t_{j}F) = t_{k} F$ dado que $T$ es un transversal a derecha de $F$ en $G$, por lo tanto existe $z_{ij} \in F$ de manera que $t_{i}t_{j} = z_{ij}t_{k}$.

		Probemos ahora que $\langle W \mid R \rangle \simeq G$.
		Sea $F_{W}$ el grupo libre sobre $W$ luego tenemos un epimorfismo $\varphi:F_{W} \to G$ dado que $W$ genera a $G$.
		Notemos que más aún por como elegimos a $W$ que resulta ser un conjunto de generadores como monoide del grupo $G$. 

		Por otro lado por como elegimos a las relaciones $R$ tenemos que $G$ las satisface.
		De esta manera por el teorema universal del cociente existe un epimorfismo de grupos $\ol \varphi$ tal que hace conmutar al siguiente diagrama	
		\begin{center}
			\begin{tikzcd}
				F_{W} \arrow[dd] \arrow[rr, "\varphi"]          &  & G \\
				&  &   \\
				H \arrow[rruu, "\overline \varphi"', dashed] &  &  
			\end{tikzcd}
		\end{center}
		
		Vimos que $\ol \varphi$ es un epimorfismo entonces veamos ahora que es un monomorfismo, esto es que dado $g' \in \langle W \mid R \rangle$ vale que $\ol{\varphi}(g') = 1 \iff g' = 1$.
		Para probar esto vamos a definir una forma normal para los elementos del grupo $\langle W \mid R \rangle$.
		Más específicamente, dada $w \in (W \cup W^{-1})^{*}$ vamos a ver que $w$ queda representada únicamente por un palabra de la pinta $st$ donde $s \in A \cup A^{-1}$ es reducida y $t \in T$. 
		
		% Un primer comentario es que dada una palabra $w \in W \cup W^{-1}$ podemos considerar una palabra $w' \in W \cup A^{-1}$ donde por cada aparición de $t_{i}^{-1}$ en $ w$ la modificamos por $v_{i}t_{k} = t_{i}^{-1}$ de manera que $v_{i} \in (A \cup A^{-1})^{*}$ y $t_{k} \in T$ usando que $T$ es un transversal a derecha de $F$ en $G$.
		% Dicho de otra manera tenemos que $W \cup A^{-1}$ es un conjunto de generadores de $\langle W \mid R \rangle$ visto como un monoide.

		% Vamos a probar que todo elemento $g' \in \langle W \mid R \rangle$ puede ser representado como una palabra de la pinta $st$ donde $s \in (A \cup A^{-1})^{*}$ reducida y $t \in T$.
		

		Sea $w \in (W \cup W^{-1})^{*}$ luego si $w \in (A \cup A^{-1})^{*}$ entonces no hay nada para hacer porque en ese caso nuestra escritura es $w = w \cdot 1$ donde tomamos $1 \in T$.
		En otro caso $w = ut_{i}v$ donde $u \in (A \cup A^{-1})^{*}$, $t_{i}$ es la primer letra de $T$ que aparece en $w$ y $v \in (W \cup W^{-1})^{*}$.
		Notemos que si $v = \epsilon$ entonces ya tenemos nuestra escritura $w = ut_{i}$.
		Supongamos entonces que la longitud de $v$ es al menos $1$.
		En este caso separamos en dos casos posibles.
		\begin{itemize}
			\item Si $v = a_{l} v'$ con $a_{l} \in A \cup A^{-1}$ y $v' \in (W \cup W^{-1})^{*}$ entonces consideramos la palabra $w' = uu_{il}t_{i}v'$ de manera que $w'$ representa al mismo elemento del grupo que $w$.
			\item Si $v = t_{j} v'$ con $t_{l} \in T$ y $v' \in (W \cup W^{-1})^{*}$ entonces consideramos la palabra $w' = uz_{ij}t_{k}v'$ de manera que $w'$ representa al mismo elemento del grupo que $w$.
		\end{itemize} 
		En ambos casos notemos que la palabra $w'$ es tal que la longitud del sufijo que le sigue posterior a la primera aparición de una letra de $T$ se reduce en tamaño.
		Esto es que si $w = ut_{i}v$ y $w' = u't_{j}v'$ con $u,u' \in (A \cup A^{-1})^{*}, t_{i}, t_{j} \in T, v,v' \in (W \cup W^{-1})^{*}$ luego 
		$|v| > |v'|$.
		Entonces como la longitud de $w$ es finita este procedimiento eventualmente termina y en tal caso obtenemos una palabra $st$ tal que representa el mismo elemento en el grupo que $w$ y que cumple que $s \in (A \cup A^{-1})^{*}$ y $t \in T$.

		Finalmente notemos que podemos reducir la palabra $s \in (A \cup A^{-1})^{*}$ para que nos quede una palabra reducida en los generadores del grupo libre $F$.
		De esta manera todo elemento $g' \in \langle W \mid R\rangle$ puede ser representado por $st$ con $s \in (A \cup A^{-1})^{*}$ reducida y $t \in T$. 
		

		Para probar que $\ol{ \varphi}$ es inyectiva notemos que si $g' \in \langle W \mid R \rangle$ luego es representada únicamente por una palabra del tipo $st$ y tenemos que $\ol{\varphi}(st) = st$ por lo tanto si $\ol{\varphi}(g') = 1$ entonces $g' = 1 \cdot 1$ lo que nos dice que $g' = 1$ tal como queríamos ver.

	\end{proof}

	\begin{obs}
		A partir de la proposición \ref{prop:presentacion_vl} podemos concluir que $G$ está presentado como un monoide por $\langle A \cup A^{-1} \cup T \mid R \rangle$.
	\end{obs}

	Sea $G$ grupo \vl  \ y consideremos una presentación $\langle W  \mid  R \rangle$ como la que construimos en \ref{prop:presentacion_vl} respetando la misma notación que introdujimos en esta proposición.
	
	Por nuestra definición del conjunto de relaciones $R$ tenemos que $R = \{t_ia_{l}t_i^{-1} = u_{il},  t_it_j = z_{ij}t_k \quad \forall (i,j,k,l) :   1 \le i,j,k \le m, 1 \le l  \le n \}$. 
	Sea entonces el conjunto finito 
	\[
	{\cal U} =  \{u_{il} : 1 \le i \le m, \ 1 \le l \le n \}  \cup  \{z_{ij} : 1 \le i,j,k \le m\} 
	\]
	donde tomamos la escritura de todas las palabras en $\cal{U}$ para que sean reducidas.
	Sea $k = \max \{ |u| \mid u \in \cal U \}$. 
	% Consideremos 
	% $\text{Suf}({\cal U})$
	% el conjunto de los sufijos de las palabras en $\cal U$, tal que es un conjunto finito también.
	
	\begin{deff}
		El \emph{k-\APD de Muller--Schupp } está definido por 
		\[
		{\cal M }= (T, W , A \cup A^{-1} \cup \{ 1 \}, \delta, 1, \{1\}, 1).
		\]
		Donde el alfabeto de la pila es $A \cup A^{-1} \cup 1$ que es el conjunto simétrico de generadores del subgrupo libre $F$ y agregamos a $1$ como símbolo inicial para la pila.
		Nuestro estado inicial que también es el final corresponde a $1 \in T$.
	
		Ahora podemos definir la función de transición. 
		Sea $w_{j} \in W$ algún generador del grupo, $s \in (A \cup A^{-1})^{*}$ luego tenemos que
		\[
		\delta(w_j,t_i, s) =
		\begin{cases}
			(t_{i}, u_{ij}^{R} \cdot s ) \quad 
			&\text{si} \ w_{j}=a_{j} \\
			(t_{k},  z_{ij}^{R} \cdot s ) \quad 
			&\text{si} \ w_{i}=t_{i} \ \text{y} \ t_{i}t_{j} = t_{k}
		\end{cases}\]
		donde $u_{ij}^{R} \cdot s$ y $z_{ij}^{R} \cdot s$ denota el producto en el grupo libre $F$.
		Por como definimos a $\cal M$ es necesariamente determínistico.
	\end{deff}

	Intuitivamente el autómata de Muller--Schupp implementa el procedimiento que empleamos en la proposición \ref{prop:presentacion_vl} para transformar una palabra $w \in W^*$ en $w = st$ con $s \in (A \cup A^{-1})^{*}$ reducida y $t \in T$.

	\begin{lema}\label{lema_MuSc_invariante}
		Sean $\cal M$ el k-\APD de Muller--Schupp y $w \in W^*$ 
		Si  
			\[
				(w,1, 1) \overset{*}{\vdash} (w', t_{j}, s)
			\]
		entonces $w = s^{R}t_{j}w'$ vistos como elementos de $G$.
	\end{lema}
	
	\begin{proof}
		Probamos ambas implicaciones a la vez usando inducción en la cantidad $l$ de pasos de la relación $\vdash$ que utilizamos.

		El caso base es que $l = 1$.
		Esto quiere decir que $(w,1, 1) \overset{}{\vdash} (w', t_{j}, s)$
		entonces separamos en dos subcasos. 
		En el primer subcaso $w = a_{i}w', \ a_{i} \in A \cup A^{-1}$.
		\[
		(a_{i}w', 1, 1 ) \vdash (w',1,a_{i})
		\]
		donde usamos que $u_{1i} = a_{i}$ y vale que  $a_{i} \cdot 1 \cdot w' = w$ así como queríamos ver.
		El otro subcaso corresponde a que $w = t_{j}w', \  t_{j} \in T$.
		\[
		(t_{i}w', 1, 1) \vdash (v, 1,1)
		\]
		donde usamos que $z_{1i1} = 1$ y vale que $1 \cdot t_{i} \cdot w' = t_{i} \cdot w'$ tal como queríamos ver.
		
		Para el paso inductivo sea $w = uw_{i}w'$ donde $u \in \text{Pre(w)}$, $|u| = l-1$ y $w_{i} \in W$.
		Por hipótesis inductiva sabemos que 
		$(w,1,1) \overset{l-1}{\vdash} (w_{i}w',t_{j},s)$ de manera que $w = s^{R}t_{j}w_{i}w'$.
		Nuevamente separamos en dos casos.


		En el primer caso $w_{i} = a_{i} \in A \cup A^{-1}$ entonces 
		$(w_{i}w', t_{j},s) \vdash (w',t_{j} , s \cdot u_{ij})$. 
		En particular notemos que dado que $t_{j}a_{i} = u_{ij}t_{j}$ por como definimos a $u_{ij} \in \cal U$ entonces necesariamente $w = s^{R}t_{j}u_{ij}w'$.
		En el segundo caso $w_{i} = t_{i} \in T$ entonces 
		$(w_{i}w', t_{j},s) \vdash (w',t_{k} , s \cdot z_{ij})$.
		En particular notemos que dado que $t_{j}t_{i} = z_{ij}t_{k}$ por como definimos a $z_{ij} \in \cal U$ entonces necesariamente $w = s^{R}t_{k}z_{ij}w'$.
	\end{proof}

	\begin{obs}
		\label{obs:conf_pal_reducida}
		Dado que todas las palabras $u \in \cal U$ las tomamos reducidas y que la función de transición de $\cal M$ realiza el producto en el grupo de la palabra que aparece en la pila con alguna palabra de $\cal U$ entonces podemos ver que en todo configuración alcanzable $(t_{j},w,s)$ con $t_{j} \in T, w \in W^{*}, s \in (A \cup A^{-1})^{*}$ vale que $s$ está reducida.
	\end{obs}

	
	
	Ya estamos en condiciones de probar el resultado central de este capítulo.

\begin{teo}\label{teo_Muller_Schupp}\cite{muller1983groups}
	Todo grupo $G$ virtualmente libre es independiente de contexto.
\end{teo}

\begin{proof}
	Consideramos una presentación $\langle W \mid R \rangle$ tal como la de la proposición \ref{prop:presentacion_vl}.
	Para probar que $G$ es \ic vamos a probar que el \APD de Muller--Schupp $\cal M$ cumple que $L({\cal M})= \text{WP}(G,W)$.
	Consideremos ahora el lenguaje aceptado por estado final y por palabra en la pila $1$:
	\[
	{L }({\cal M}, 1) = \{  w \in W^* \mid (w,1,1)   \vdash^*  (\epsilon, 1, 1)  \}.
	\]
	Debemos ver que el autómata acepta justamente al lenguaje que queremos. 
	Esto es que $ {\cal L }(M) = \text{WP}(G,W) $ 
	
	Si $w \in L({\cal M},1)$ entonces $(w, 1, 1) \overset{*}{\vdash} (\epsilon, 1, 1)$ y por lo tanto por el lema \ref{lema_MuSc_invariante} obtenemos que $w = 1$ y así que $w \in \text{WP}(G,W)$.
	
	Si $w \in \text{WP}(G,W)$ entonces $w = 1$ en $G$ por lo que nuevamente usando el lema \ref{lema_MuSc_invariante} obtenemos que $(w, 1, 1) \overset{*}{\vdash} (\epsilon, 1, s)$
	tal que $w = s^{R} \cdot 1$ y por la observación \ref{obs:conf_pal_reducida} concluimos que $s = 1$ y así $w \in L({\cal M},1)$.
	
	
	Con esto probamos que los grupos virtualmente libres son \ic usando la equivalencia \ref{prop:equiv_kapnd_apnd}.
	
\end{proof}



% 	Sea $u \in \text{Suf}({\cal U})$ tal que $u \neq 1$ luego si $u = a_{i}v $ donde $v \in \text{Suf}(\cal U)$ y $a_{i} \in A \cup A^{-1}$ 
% 	en este caso definimos 
% 	\begin{equation*}
% 		\delta(\epsilon,(t_j,w_i,a_{i}v), s) = ((t_j,w_i,v), a_{i} \cdot s).
% 	\end{equation*}
% 	La notación $v \cdot a_{i}$ representa el producto en el grupo libre $F$ de $v \in F$ con $a_{i}$ un generador en $F$.
% 	Notemos que para cada configuración del tipo $(w,(t_{j}, w_{i}, u),s)$ existe una única transición posible dado que fijamos de antemano alguna escritura única en los generadores $A$ para cada palabra $u \in \cal U$.
	
% 	Finalmente definimos la función de transición de la siguiente manera para todo $w_{i} \in W$ y $t_{j} \in T$,
% 	\[
% 		\delta(\epsilon, (t_{j},w_{i},1), s) = ((t_{j},1,1),s).
% 	\]


% 	\begin{lema}\label{lema_MuSc_invariante}
% 	Sea $\cal M$ el \APD de Muller--Schupp, $w \in W^*$ tal que $ w = uv $ entonces  
% 		\[
% 			(uv,(1,1,1), 1) \overset{*}{\vdash} (v, (t_{k},1,1), s^R)
% 		\]
% 		si y solo sí $u = st_{k}$.
% 	\end{lema}
	
% 	\begin{proof}
% 		Probamos ambas implicaciones a la vez usando inducción en la longitud de $u$.
% 		El caso base es que $|u| = 1$.
% 		Separamos en dos subcasos. 
% 		En el primer subcaso $u = a_{i} \in B$.
% 		\[
% 		(a_{i}v, ( 1,1,1), 1 ) \vdash (v, (1,a_{i},a_{i}),1) \vdash (v,(1,a_{i},1),a_{i}) \vdash (v, (1,1,1), a_{i})
% 		\]
% 		tal que $1 \cdot a_{i} = a_{i}$ así como queríamos ver.
% 		El otro subcaso corresponde a que $u = t_{j} \in T$.
% 		\[
% 		(t_{i}v, (1,1,1), 1) \vdash (v, (t_{i},t_{i},t_{i}),1) \vdash (v,(t_{i},t_{i},1),1) \vdash (v, (t_{i},1,1), 1)
% 		\]
% 		donde usamos que $z_{1i1} = 1$ y cumple que $t_{i} \cdot 1 = t_{i}$ tal como queríamos ver.
% 		De manera idéntica vemos que vale la vuelta.
		
% 		Para el paso inductivo sea $u = u'w_{i}$ donde $u' \in \text{Pre(w)}$ y $w_{i} \in W$.

% 		Tenemos que por hipótesis inductiva
% 		\[
% 		(u'a_{i}v, ( 1,1,1), 1 ) \overset{*}{\vdash} (a_{i}v, (t_{k},1,1), s^R)
% 		\]
% 		de manera que $st_{k} = u'$.
		
% 		Nuevamente separamos en casos.
% 		En el caso que $w_{i} = a_{i} \in A \cup A^{-1}$	
% 		si usamos la definición del autómata obtenemos que  
% 		\[
% 			(a_{i}v, (t_{k},1,1), s^R) {\vdash} 
% 			(v, (t_{k},a_{i},u_{ki}), s^R ) \overset{*}{\vdash }
% 			(v, (t_{k}, 1,1), u_{ki}^R \cdot s^R)
% 		\]
% 		si y solo si $st_{k}a_{i} = su_{ik}t_{k}$.
% 		Para el caso que $w_{i} = t_{i} \in T$ similarmente si $t_{k}t_{i} = z_{kij} t_{j}$ luego
% 		\[
% 		(t_{i}v, (t_{k},1,1), s^R) {\vdash} 
% 		(v, (t_{j},t_{j},z_{kij}), s^R ) \overset{*}{\vdash }
% 		(v, (t_{k}, 1,1), z_{kij}^R \cdot s^R)
% 		\]
% 		si y solo si $st_{k}t_{i} = sz_{kij}t_{j}$.
% 	\end{proof}
	
	
% 	Intuitivamente el autómata de Muller--Schupp formaliza el procedimiento que empleamos en la proposición \ref{prop:presentacion_vl} para transformar una palabra $w \in W^*$ en $w = st$ con $s \in (A \cup A^{-1})^{*}$ reducida y $t \in T$.
	
% 	Ya estamos en condiciones de probar el resultado central de este capítulo.

% \begin{teo}\label{teo_Muller_Schupp}\cite{muller1983groups}
% 	Todo grupo virtualmente libre es independiente de contexto.
% \end{teo}

% \begin{proof}
% 	Para probar que es \ic vamos a probar que el \APD de Muller--Schupp $\cal M$ cumple que $L({\cal M})= \text{WP}(G,W)$.
% 	Consideremos ahora el lenguaje aceptado por estado final y por palabra en la pila $1$:
% 	\[
% 	{\cal L }(M) = \{  w \in W^* \mid (w,(1,1,1),1)   \vdash^*  (\epsilon, (1,1,1), 1)  \}.
% 	\]
% 	Debemos ver que el autómata acepta justamente al lenguaje que queremos. 
% 	Esto es que $ {\cal L }(M) = \text{WP}(G,W) $ 
	
% 	Si $w \in L(\cal M)$ entonces $(w, (1,1,1), 1) \overset{*}{\vdash} (\epsilon, (1,1,1), 1)$ y por lo tanto por el lema \ref{lema_MuSc_invariante} obtenemos que $w = 1$ y así que $w \in \text{WP}(G,W)$.
	
% 	Si $w \in \text{WP}(G,W)$ entonces $w = 1$ en $G$ por lo que nuevamente usando el lema \ref{lema_MuSc_invariante} obtenemos que $(w, (1,1,1), 1) \overset{*}{\vdash} (\epsilon, (t_{i},1,1), s)^{R}$
% 	y esto implica que $st_{i} = 1$ por lo que $t_{i} = 1, s =1$ y así $w \in L(\cal M)$.
	
	
% 	Con esto probamos que los grupos virtualmente libres son \ic usando la equivalencia \ref{teo_ic_apnd}.
	
% \end{proof}
\end{document}

